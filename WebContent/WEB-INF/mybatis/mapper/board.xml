<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">

<!-- 자유게시판 목록 쿼리문 -->
<select id="listBoard" resultType="map">
	SELECT
	      ROW_NUMBER() OVER(ORDER BY BR.BBS_CODE) NUM
	    , BR.BBS_CODE  AS CODE
	    , U.USER_NAME  AS NAME
	    , BR.TITLE     AS TITLE
	    , BR.CONTENT   AS CONTENT
	    , BT.BBS_TYPE  AS TYPE
	    , BR.POST_DATE AS POST_DATE
	    , BR.HIT_COUNT AS HITCOUNT
	    , BL2.LIKE_COUNT    AS LIKE_COUNT
	    , NVL(BC2.CMT_COUNT, 0)    AS CMT_COUNT
	FROM BBS_REG BR
	JOIN USER_REG U ON BR.USER_CODE = U.USER_CODE
	JOIN BBS_TYPE BT ON BR.TYPE_CODE = BT.BBS_TYPE_CODE
	JOIN (SELECT BL.BBS_CODE, COUNT(*) AS LIKE_COUNT FROM BBS_LIKE BL, BBS_REG BR WHERE BL.BBS_CODE = BR.BBS_CODE GROUP BY BR.BBS_CODE) BL2 
	    ON BR.BBS_CODE = BL2.BBS_CODE
	LEFT JOIN (SELECT BC.BBS_CODE, COUNT(*) AS CMT_COUNT FROM BBS_CMT BC, BBS_REG BR WHERE BC.BBS_CODE = BR.BBS_CODE GROUP BY BC.BBS_CODE) BC2
	    ON BR.BBS_CODE = BC2.BBS_CODE
	ORDER BY BR.POST_DATE DESC
</select>

<select id="countList" resultType="java.lang.Integer">
	SELECT COUNT(*)
	FROM BBS_REG
</select>

</mapper>