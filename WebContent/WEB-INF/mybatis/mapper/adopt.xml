<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adopt">

<!-- 입양게시판 전체 리스트 출력 쿼리문 -->
<select id="listAdopt" resultType="map">
	SELECT A.CAT_NAME AS CAT_NAME
	     , CT.SPECIES AS CAT_TYPE
	     , CS.SEX AS CAT_SEX
	     , A.CAT_AGE AS CAT_AGE
	     , AD.SI || ' ' || AD.GU || ' ' || AD.DONG AS CAT_ADDRESS
	     , AP.ADT_PROC AS ADT_PROC
	     , AT.ADT_TYPE AS ADT_TYPE
	     , A.HIT_COUNT AS HITCOUNT
	     , A.POST_DATE AS POST_DATE
	     , A.CAT_REP_IMG AS CAT_IMAGE
	     , A.ADT_CODE AS ADT_CODE
	FROM ADT_REG A 
	JOIN CAT_TYPE CT
	ON A.CAT_SPECIES = CT.SPECIES_CODE
	JOIN CAT_SEX CS
	ON A.CAT_SEX = CS.SEX_CODE
	JOIN ADDRESS AD
	ON A.CAT_ADDRESS = AD.ADDRESS_CODE
	JOIN ADT_PROCESS AP
	ON A.ADT_PROC_CODE = AP.ADT_PROC_CODE
	JOIN ADT_TYPE AT
	ON A.ADT_TYPE = AT.ADT_TYPE_CODE
	ORDER BY A.POST_DATE
</select>
 
<!-- 구와 동을 입력받아 주소 코드를 반환하는 쿼리문 -->
<select id="searchAddress" parameterType="map" resultType="java.lang.String">
	SELECT ADDRESS_CODE
	FROM ADDRESS
	WHERE SI = '서울시' AND GU = #{gu} AND DONG = #{dong}
</select>

<!-- 입양게시판 지역 검색 후 리스트 출력 쿼리문 -->
<select id="searchList" parameterType="map" resultType="map">
	SELECT A.CAT_NAME AS CAT_NAME
	     , CT.SPECIES AS CAT_TYPE
	     , CS.SEX AS CAT_SEX
	     , A.CAT_AGE AS CAT_AGE
	     , AD.SI || ' ' || AD.GU || ' ' || AD.DONG AS CAT_ADDRESS
	     , AP.ADT_PROC AS ADT_PROC
	     , AT.ADT_TYPE AS ADT_TYPE
	     , A.HIT_COUNT AS HITCOUNT
	     , A.POST_DATE AS POST_DATE
	     , A.CAT_REP_IMG AS CAT_IMAGE
	     , A.ADT_CODE AS ADT_CODE
	FROM ADT_REG A 
	JOIN CAT_TYPE CT
	ON A.CAT_SPECIES = CT.SPECIES_CODE
	JOIN CAT_SEX CS
	ON A.CAT_SEX = CS.SEX_CODE
	JOIN ADDRESS AD
	ON A.CAT_ADDRESS = AD.ADDRESS_CODE
	JOIN ADT_PROCESS AP
	ON A.ADT_PROC_CODE = AP.ADT_PROC_CODE
	JOIN ADT_TYPE AT
	ON A.ADT_TYPE = AT.ADT_TYPE_CODE
    WHERE AD.GU = #{searchGu} AND AD.DONG = #{searchDong}
	ORDER BY A.POST_DATE
</select>

<!-- 검색된 게시글 수 조회 쿼리문  -->
<select id="countList" parameterType="map" resultType="java.lang.Integer">
	SELECT COUNT(*) AS dataCount
	FROM ADT_REG A
	JOIN ADDRESS AD
	ON A.CAT_ADDRESS = AD.ADDRESS_CODE
	WHERE AD.GU = #{searchGu} AND AD.DONG = #{searchDong}
</select>

 
<!-- 입양게시글 등록자 정보 조회 --> 
<select id="searchUserInfo" parameterType="java.lang.String" resultType="map">
	SELECT USER_CODE, ID, USER_NAME, TEL, EMAIL
	FROM USER_REG
	WHERE ID = #{user_id, jdbcType=VARCHAR}
</select>
 
<!-- 입양 모집글 등록 쿼리문 -->
<!-- 이미지첨부 기능 완료되면 이미지 파일 값 넘겨야..  -->
<insert id="addAdopt" parameterType="hashmap">
	INSERT INTO ADT_REG (ADT_CODE, ADT_PROC_CODE, CAT_NAME, CAT_ADDRESS, RSQ_DATE, CAT_SPECIES
        , CAT_AGE_CODE, CAT_AGE, CAT_SEX, ADT_TYPE, CAT_ECT1, CAT_ECT2, CAT_REP_IMG, USER_CODE, TEL
        , EMAIL, ADT_REASON, ADT_CAT_EXP, ADT_JOB, ADT_MARRIAGE, ADT_FAMILY_NUM)
	VALUES ('ADO'||ADT_CODE_SEQ.NEXTVAL, 'ADP1', #{CAT_NAME,jdbcType=VARCHAR}, #{ADDRESS,jdbcType=VARCHAR}
	, #{RSQ_DATE,jdbcType=DATE},#{CAT_SPECIES,jdbcType=VARCHAR}, #{CAT_AGE_TYPE,jdbcType=VARCHAR}
	, #{CAT_AGE_NUM,jdbcType=VARCHAR}, #{CAT_SEX,jdbcType=VARCHAR}, #{ADT_TYPE,jdbcType=VARCHAR}
	, #{CAT_ETC1,jdbcType=VARCHAR}, #{CAT_ETC2,jdbcType=VARCHAR}, 'aaa124.png', #{USER_CODE,jdbcType=VARCHAR}, #{TEL,jdbcType=VARCHAR}
	, #{EMAIL,jdbcType=VARCHAR}, #{ADT_REASON,jdbcType=VARCHAR}, #{ADT_CAT_EXP,jdbcType=VARCHAR}
	, #{ADT_JOB,jdbcType=VARCHAR}, #{ADT_MARRIAGE,jdbcType=VARCHAR}, #{ADT_FAMILY_NUM,jdbcType=VARCHAR})
</insert> 

 
<!-- 입양 모집글 열람 쿼리문 -->
<select id="readAdopt" parameterType="java.lang.String" resultType="map">
	SELECT A.CAT_NAME AS CAT_NAME
	     , U.NICKNAME AS USER_NICKNAME
	     , A.RSQ_DATE AS RSQ_DATE
	     , CT.SPECIES AS CAT_TYPE
	     , CS.SEX AS CAT_SEX
	     , A.CAT_AGE AS CAT_AGE
	     , AD.SI || ' ' || AD.GU || ' ' || AD.DONG AS CAT_ADDRESS
	     , CA.CAT_AGE_TYPE AS CAT_AGE_TYPE
	     , AP.ADT_PROC AS ADT_PROC
	     , AT.ADT_TYPE AS ADT_TYPE
	     , A.HIT_COUNT AS HITCOUNT
	     , A.POST_DATE AS POST_DATE
	     , A.CAT_REP_IMG AS CAT_IMAGE
	     , A.CAT_ECT1 AS CAT_ECT1
	     , A.CAT_ECT2 AS CAT_ECT2
	     , U.ID AS USER_ID
	     , U.USER_NAME AS USER_NAME
	     , U.TEL AS USER_TEL
	     , U.EMAIL AS USER_EMAIL
	FROM ADT_REG A 
	JOIN USER_REG U
	ON A.USER_CODE = U.USER_CODE
	JOIN CAT_TYPE CT
	ON A.CAT_SPECIES = CT.SPECIES_CODE
	JOIN CAT_SEX CS
	ON A.CAT_SEX = CS.SEX_CODE
	JOIN ADDRESS AD
	ON A.CAT_ADDRESS = AD.ADDRESS_CODE
	JOIN ADT_CAT_AGE CA
	ON A.CAT_AGE_CODE = CA.CAT_AGE_CODE
	JOIN ADT_PROCESS AP
	ON A.ADT_PROC_CODE = AP.ADT_PROC_CODE
	JOIN ADT_TYPE AT
	ON A.ADT_TYPE = AT.ADT_TYPE_CODE
	WHERE ADT_CODE = #{id}
</select>

<!-- 셀렉트 박스 구 리스트 조회 쿼리문-->
<select id="listGu" resultType="map">
	SELECT DISTINCT GU AS GU
	FROM ADDRESS
	ORDER BY GU ASC
</select>

<!-- 셀렉트 박스 동 리스트 조회 쿼리문 -->
<select id="listDong" resultType="map">
	SELECT DONG
	FROM ADDRESS
	WHERE GU=#{selectedGu,jdbcType=VARCHAR}
	ORDER BY DONG ASC
</select>

<!-- 게시글 상태 변경 쿼리문 -->
<!-- <update id="changeProcess" parameterType="map">
	UPDATE ADT_REG
	SET ADT_PROC_CODE = 'ADP2'
	WHERE ADT_CODE = 'ADO29'
</update>
 -->

</mapper>