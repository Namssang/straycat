<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adopt">

<!-- 입양게시판 리스트 쿼리문 -->
<select id="listAdopt" resultType="map">
	SELECT A.CAT_NAME AS CAT_NAME
	     , CT.SPECIES AS CAT_TYPE
	     , CS.SEX AS CAT_SEX
	     , A.CAT_AGE AS CAT_AGE
	     , AD.SI || ' ' || AD.GU || ' ' || AD.DONG AS CAT_ADDRESS
	     , AP.ADT_PROC AS ADT_PROC
	     , AT.ADT_TYPE AS ADT_TYPE
	     , A.HIT_COUNT AS HITCOUNT
	     , A.POST_DATE AS POST_DATE
	     , A.CAT_REP_IMG AS CAT_IMAGE
	     , A.ADT_CODE AS ADT_CODE
	FROM ADT_REG A 
	JOIN CAT_TYPE CT
	ON A.CAT_SPECIES = CT.SPECIES_CODE
	JOIN CAT_SEX CS
	ON A.CAT_SEX = CS.SEX_CODE
	JOIN ADDRESS AD
	ON A.CAT_ADDRESS = AD.ADDRESS_CODE
	JOIN ADT_PROCESS AP
	ON A.ADT_PROC_CODE = AP.ADT_PROC_CODE
	JOIN ADT_TYPE AT
	ON A.ADT_TYPE = AT.ADT_TYPE_CODE
	ORDER BY A.POST_DATE
</select>

<!-- <insert id="addAdopt">
	<selectKey keyProperty="ADDRESS" resultType="map" order="BEFORE">
		SELECT ADDRESS_CODE AS ADDRESS
		FROM ADDRESS
		WHERE SI = '서울시' AND GU = #{gu} AND DONG = #{dong}
	</selectKey>
	EXEC PRC_ADT_REG_INSERT(#{ADT_PROC}, #{CAT_NAME}, #{ADDRESS}, #{RSQ_DATE}, #{CAT_SPECIES}, #{CAT_AGE_TYPE}, #{CAT_AGE_NUM}, #{CAT_SEX}, #{ADT_TYPE}, #{CAT_ETC1}, #{CAT_ETC2}, 'straycat.png', 'US2', #{TEL},#{EMAIL}, #{ADT_REASON}, #{ADT_CAT_EXP}, #{ADT_JOB}, #{ADT_MARRIAGE}, #{ADT_FAMILY_NUM})
</insert>
-->
 
<!-- 구와 동을 입력받아 주소 코드를 반환하는 쿼리문 -->
<select id="searchAddress" parameterType="map" resultType="java.lang.String">
	SELECT ADDRESS_CODE
	FROM ADDRESS
	WHERE SI = '서울시' AND GU = #{gu} AND DONG = #{dong}
</select>
 
 
<!-- 입양 게시글 등록 쿼리문 -->
<insert id="addAdopt" parameterType="hashmap">
	 <selectKey resultType="string" keyProperty="ADT_CODE" order="BEFORE">
        SELECT MAX(ROWNUM)+1
        FROM ADT_REG        
    </selectKey>
	INSERT INTO ADT_REG (ADT_CODE, ADT_PROC_CODE, CAT_NAME, CAT_ADDRESS, RSQ_DATE, CAT_SPECIES
        , CAT_AGE_CODE, CAT_AGE, CAT_SEX, ADT_TYPE, CAT_ECT1, CAT_ECT2, CAT_REP_IMG, USER_CODE, TEL
        , EMAIL, ADT_REASON, ADT_CAT_EXP, ADT_JOB, ADT_MARRIAGE, ADT_FAMILY_NUM)
	VALUES ('ADO'||#{ADT_CODE}, 'ADP1', #{CAT_NAME,jdbcType=VARCHAR}, #{ADDRESS,jdbcType=VARCHAR}
	, #{RSQ_DATE,jdbcType=DATE},#{CAT_SPECIES,jdbcType=VARCHAR}, #{CAT_AGE_TYPE,jdbcType=VARCHAR}
	, #{CAT_AGE_NUM,jdbcType=VARCHAR}, #{CAT_SEX,jdbcType=VARCHAR}, #{ADT_TYPE,jdbcType=VARCHAR}
	, #{CAT_ETC1,jdbcType=VARCHAR}, #{CAT_ETC2,jdbcType=VARCHAR}, 'aaa124.png', 'US3', #{TEL,jdbcType=VARCHAR}
	, #{EMAIL,jdbcType=VARCHAR}, #{ADT_REASON,jdbcType=VARCHAR}, #{ADT_CAT_EXP,jdbcType=VARCHAR}
	, #{ADT_JOB,jdbcType=VARCHAR}, #{ADT_MARRIAGE,jdbcType=VARCHAR}, #{ADT_FAMILY_NUM,jdbcType=VARCHAR})
</insert> 
 
 
 

</mapper>